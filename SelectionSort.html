<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selection Sort - Interactive Workbench</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #64748b;
            --accent: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-page: #f8fafc;
            --bg-panel: #ffffff;
            --border: #e2e8f0;
            --code-bg: #1e293b;
            
            /* Trace Log Colors */
            --trace-bg: #f3f4f6;
            --trace-hl-yellow: #fde047;
            --trace-hl-green: #86efac;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: #1e293b;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* --- HEADER --- */
        header {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 15px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 70px;
            flex-shrink: 0;
            z-index: 10;
            position: relative;
        }

        .brand { display: flex; align-items: center; gap: 15px; }
        .brand h1 { font-size: 1.5rem; font-weight: 800; color: #0f172a; }
        .brand .emoji { font-size: 1.8rem; }

        /* --- MAIN LAYOUT --- */
        .workbench {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        /* --- THEORY AREA --- */
        .theory-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: stretch;
        }
        @media (max-width: 600px) { .theory-area { grid-template-columns: 1fr; } }

        .details-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
            min-height: 400px;
        }

        .panel-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .scenario-content {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            color: #92400e;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        /* Code Block */
        .code-container {
            background: var(--code-bg);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .code-header-row {
            display: flex; justify-content: space-between; align-items: center;
            background: #0f172a; padding: 8px 10px; border-bottom: 1px solid #334155;
            flex-wrap: wrap; gap: 10px;
        }

        .code-tabs, .view-mode-tabs { display: flex; gap: 2px; }
        .tab, .view-btn {
            background: transparent; border: none; color: #94a3b8;
            padding: 6px 12px; font-size: 0.8rem; font-weight: 600;
            cursor: pointer; border-radius: 6px; transition: 0.2s;
        }
        .tab:hover, .view-btn:hover { background: rgba(255,255,255,0.1); }
        .tab.active { background: #334155; color: white; }
        .view-btn.active { background: #3b82f6; color: white; }

        .code-editor {
            padding: 15px; font-family: 'Fira Code', monospace;
            font-size: 0.85rem; line-height: 1.6; color: #e2e8f0;
            overflow-x: auto; flex: 1; 
        }

        .code-line { padding: 2px 10px; border-radius: 4px; white-space: pre; }
        .code-line.active-line {
            background: rgba(251, 191, 36, 0.2);
            border-left: 3px solid var(--warning); color: #fbbf24;
        }
        
        .comment-time { color: #f59e0b; font-style: italic; font-weight: bold; }
        .comment-space { color: #3b82f6; font-style: italic; font-weight: bold; }
        .comment-std { color: #94a3b8; font-style: italic; }

        /* --- UPDATED LOGIC LIST STYLES (Numbered & Aligned) --- */
        .logic-list ol { 
            list-style: none; /* Remove default marker */
            counter-reset: logic-counter; /* Initialize counter */
            padding: 0;
            margin: 0;
        }
        .logic-list li {
            display: flex; /* Use flex to align number and text */
            align-items: flex-start;
            padding: 10px 0; 
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.95rem; 
            color: #334155;
        }
        .logic-list li::before {
            counter-increment: logic-counter;
            content: counter(logic-counter) ".";
            color: var(--primary); 
            font-weight: 700;
            min-width: 25px; /* Fixed width for the number column */
            margin-right: 5px;
        }

        /* --- VISUAL SECTION --- */
        .visual-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stage-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            /* Fixed height for stability */
            height: 600px; 
            min-height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stage-header {
            padding: 15px 20px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; flex-shrink: 0;
        }
        
        .status-badge {
            background: #e0f2fe; color: #0369a1; padding: 5px 12px;
            border-radius: 20px; font-size: 0.85rem; font-weight: 600;
        }

        /* --- SPLIT LAYOUT (50/50) --- */
        .visual-body {
            display: flex;
            flex: 1;
            overflow: hidden; /* Prevents outer scroll */
        }

        /* LEFT: Graph */
        .canvas-wrapper {
            flex: 1;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 60px 20px 40px 20px;
            gap: 8px;
            background-color: #f0fdf4; /* Slightly green tint for selection sort distinction */
            border-right: 1px solid var(--border);
        }

        .bar {
            width: 40px;
            background: var(--primary);
            border-radius: 8px 8px 0 0;
            transition: height 0.3s ease, background-color 0.3s;
            position: relative;
            display: flex;
            justify-content: center;
        }

        .bar span {
            position: absolute; bottom: -30px; font-family: 'Fira Code', monospace;
            font-size: 0.9rem; font-weight: 600; color: #64748b;
        }

        /* Bar Colors */
        .bar.compare { background: var(--warning) !important; }
        .bar.swap { background: var(--danger) !important; }
        .bar.sorted { background: var(--success) !important; }
        .bar.min { background: var(--accent) !important; } /* Unique for Selection Sort */

        /* RIGHT: Trace Log */
        .trace-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: 100%; /* Fill remaining height */
            overflow: hidden;
        }

        .trace-header {
            padding: 10px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #f8fafc;
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .trace-log-container {
            flex: 1;
            overflow-y: auto; /* THIS enables scrolling */
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            font-family: 'Fira Code', monospace;
            scroll-behavior: smooth;
        }

        /* PROFESSIONAL SCROLLBAR STYLING */
        .trace-log-container::-webkit-scrollbar {
            width: 6px; /* Small width */
        }
        .trace-log-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .trace-log-container::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        .trace-log-container::-webkit-scrollbar-thumb:hover {
            background-color: #94a3b8;
        }

        /* Step Items */
        .trace-step {
            display: flex;
            flex-direction: column;
            gap: 5px;
            animation: fadeIn 0.3s ease-in;
        }

        .trace-array-row {
            background: var(--trace-bg);
            padding: 8px 12px;
            border-radius: 6px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 0.85rem;
            color: #374151;
            align-items: center;
        }

        .num-span {
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* Log Highlights */
        .hl-yellow { background-color: var(--trace-hl-yellow); color: #000; font-weight: 700; }
        .hl-green { background-color: var(--trace-hl-green); color: #064e3b; font-weight: 700; }
        .hl-accent { background-color: #ddd6fe; color: #5b21b6; font-weight: 700; }

        .trace-message {
            font-size: 0.8rem;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .arrow-icon { color: #9ca3af; font-size: 1rem; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* Controls */
        .controls-toolbar {
            background: white;
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            flex-shrink: 0;
        }

        .control-group {
            display: flex; align-items: center; gap: 10px;
            padding-right: 20px; border-right: 1px solid var(--border);
        }
        .control-group:last-child { border: none; }

        button.btn {
            padding: 10px 18px; border-radius: 8px; border: 1px solid var(--border);
            background: white; font-weight: 600; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 6px; font-size: 0.95rem;
        }
        button.btn:hover { background: #f8fafc; border-color: #cbd5e1; }
        button.btn-primary { background: var(--primary); color: white; border: none; }
        button.btn-primary:hover { background: #2563eb; }
        button.btn-danger { color: var(--danger); border-color: #fca5a5; background: #fef2f2; }
        input[type="text"] { padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px; width: 200px; font-family: 'Fira Code', monospace; }

        /* Dropdown CSS */
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content {
            display: none; 
            position: absolute; 
            bottom: 100%; 
            left: 0;
            background-color: white; min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15); border-radius: 8px;
            border: 1px solid var(--border); z-index: 50;
        }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-item {
            padding: 10px 16px; cursor: pointer; font-size: 0.9rem; color: #334155;
            display: block; border-bottom: 1px solid #f1f5f9; transition: 0.2s;
        }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background-color: #f8fafc; color: var(--primary); }


        /* --- COMPLEXITY SECTION --- */
        .complexity-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid var(--border);
        }

        .complexity-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .complexity-table th {
            text-align: left;
            padding: 12px 15px;
            background: #f8fafc;
            color: #64748b;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        .complexity-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f1f5f9;
            color: #334155;
            vertical-align: top;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-weight: 700;
            font-size: 0.85rem;
        }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-yellow { background: #fef3c7; color: #92400e; }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            <span class="emoji">üîç</span>
            <div>
                <h1>Selection Sort</h1>
            </div>
        </div>
    </header>

    <div class="workbench">
        

                <main class="visual-area">
            <div class="stage-container">
                <div class="stage-header">
                    <div class="panel-title" style="margin:0; font-size: 1.1rem;">üëÄ Visual Example</div>
                    <div class="header-controls">
                        <div class="status-badge" id="statusText">Ready to Sort</div>
                        </div>
                </div>

                <div class="visual-body">
                    <div class="canvas-wrapper" id="barContainer"></div>

                    <div class="trace-wrapper">
                        <div class="trace-header">
                            <span>Step Log</span>
                            <button onclick="clearLog()" style="border:none; background:none; cursor:pointer; color:#94a3b8;" title="Clear Log">üóëÔ∏è</button>
                        </div>
                        <div class="trace-log-container" id="traceLog">
                            <div style="color:#9ca3af; text-align:center; margin-top:50px; font-size:0.9rem;">
                                Press Play to see the sort trace...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls-toolbar">
                    <div class="control-group">
                        <input type="text" id="customInput" placeholder="e.g. 50, 20, 10, 40">
                        <button class="btn" onclick="initCustom()">Load</button>
                        
                        <div class="dropdown">
                            <button class="btn">Generate ‚ñæ</button>
                            <div class="dropdown-content">
                                <div class="dropdown-item" onclick="initBest()">Best Case</div>
                                <div class="dropdown-item" onclick="initRandom()">Average (Random)</div>
                                <div class="dropdown-item" onclick="initWorst()">Worst Case</div>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <button class="btn btn-primary" id="btnPlay" onclick="startSort()">Play ‚ñ∂</button>
                        <button class="btn" id="btnPause" onclick="pauseSort()" disabled>Pause ‚è∏</button>
                        <button class="btn" id="btnStep" onclick="stepSort()">Step ‚è≠</button>
                        <button class="btn btn-danger" onclick="reset()">Reset ‚Ü∫</button>
                    </div>

                    <div class="control-group" style="border:none">
                        <label for="speedRange" style="font-size:0.85rem; font-weight:600; margin-right:8px;">Speed:</label>
                        <input type="range" id="speedRange" min="50" max="1000" value="500" style="width:100px;">
                    </div>
                </div>
            </div>
        </main>

        <section class="theory-area">
            <div class="details-panel">
                <div class="panel-title"><span>üéØ Real World Scenario</span></div>
                <div class="scenario-content">
                    Organizing books on a shelf: You scan the entire shelf to find the shortest book and swap it with the first one. Then you scan the remaining books for the next shortest and place it second, repeating until done.
                </div>
                <div class="panel-title"><span>‚öôÔ∏è How It Works</span></div>
                <div class="logic-list">
                    <ol>
                        <li>Assume the current position <code>i</code> is the minimum.</li>
                        <li>Scan the rest of the array (from <code>i + 1</code> to end).</li>
                        <li>If you find a number smaller than the current minimum, mark it as the new <strong>Minimum</strong>.</li>
                        <li>After scanning the unsorted part, if the Minimum is not at <code>i</code>, <strong>swap</strong> them.</li>
                        <li>Move to the next position and repeat until the array is sorted.</li>
                    </ol>
                </div>
            </div>

            <div class="details-panel">
                <div class="panel-title"><span>üíª Code Implementation</span></div>
                <div class="code-container">
                    <div class="code-header-row">
                        <div class="code-tabs">
                            <button class="tab active" onclick="setLang('python')">Python</button>
                            <button class="tab" onclick="setLang('cpp')">C++</button>
                            <button class="tab" onclick="setLang('js')">JS</button>
                        </div>
                        <div class="view-mode-tabs">
                            <button class="view-btn active" id="btn-standard" onclick="setViewMode('standard')">Code</button>
                            <button class="view-btn" id="btn-time" onclick="setViewMode('time')">‚è± Time</button>
                            <button class="view-btn" id="btn-space" onclick="setViewMode('space')">üíæ Space</button>
                        </div>
                    </div>
                    <div class="code-editor" id="codeDisplay"></div>
                </div>
            </div>
        </section>


        <div class="complexity-section">
            <div class="panel-title">üìä Elaborated Complexity Analysis</div>
            <table class="complexity-table">
                <thead>
                    <tr>
                        <th width="15%">Metric</th>
                        <th width="15%">Complexity</th>
                        <th>Explanation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Worst Case</strong></td>
                        <td><span class="badge badge-red">O(n¬≤)</span></td>
                        <td>Occurs regardless of order (e.g., reverse sorted). We always scan the remaining array to find the minimum. Total comparisons: n(n-1)/2.</td>
                    </tr>
                    <tr>
                        <td><strong>Best Case</strong></td>
                        <td><span class="badge badge-yellow">O(n¬≤)</span></td>
                        <td>Unlike Insertion Sort, Selection Sort <strong>always</strong> scans the unsorted portion fully, even if the array is already sorted.</td>
                    </tr>
                    <tr>
                        <td><strong>Average Case</strong></td>
                        <td><span class="badge badge-yellow">O(n¬≤)</span></td>
                        <td>On random data, the quadratic number of comparisons remains consistent.</td>
                    </tr>
                    <tr>
                        <td><strong>Space</strong></td>
                        <td><span class="badge badge-blue">O(1)</span></td>
                        <td><strong>In-Place Sort.</strong> Requires constant extra space for <code>min_idx</code> and temp variables for swapping.</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <script>
        // --- DATA & STATE ---
        const codeSnippets = {
            python: {
                standard: ["def selection_sort(arr):", "    n = len(arr)", "    for i in range(n):", "        min_idx = i", "        # Scan for smallest in unsorted part", "        for j in range(i + 1, n):", "            if arr[j] < arr[min_idx]:", "                min_idx = j", "        # Swap if new minimum found", "        if min_idx != i:", "            arr[i], arr[min_idx] = arr[min_idx], arr[i]"],
                time: ["# TIME COMPLEXITY: O(n^2)", "def selection_sort(arr):", "    n = len(arr)", "    for i in range(n):          # Outer Loop: n times", "        min_idx = i", "        for j in range(i + 1, n): # Inner Loop: n-i times", "            if arr[j] < arr[min_idx]: # Comparison: O(1)", "                min_idx = j", "        if min_idx != i:          # Swap: O(1)", "            arr[i], arr[min_idx] = arr[min_idx], arr[i]", "# Total comparisons always ~ n^2/2"],
                space: ["# SPACE COMPLEXITY: O(1)", "def selection_sort(arr):", "    n = len(arr)", "    for i in range(n):", "        min_idx = i  # 1 var for index -> O(1)", "        for j in range(i + 1, n):", "            if arr[j] < arr[min_idx]:", "                min_idx = j", "        if min_idx != i:", "            # Swap needs 1 temp var (internal)", "            arr[i], arr[min_idx] = arr[min_idx], arr[i]", "# No auxiliary arrays used."]
            },
            cpp: {
                standard: ["void selectionSort(vector<int>& arr) {", "    int n = arr.size();", "    for (int i = 0; i < n - 1; i++) {", "        int min_idx = i;", "        // Find the minimum element", "        for (int j = i + 1; j < n; j++) {", "            if (arr[j] < arr[min_idx])", "                min_idx = j;", "        }", "        // Swap the found minimum with first element", "        if (min_idx != i)", "            swap(arr[i], arr[min_idx]);", "    }", "}"],
                time: ["// TIME COMPLEXITY: O(n^2)", "void selectionSort(vector<int>& arr) {", "    int n = arr.size();", "    for (int i = 0; i < n - 1; i++) { // Outer: O(n)", "        int min_idx = i;", "        for (int j = i + 1; j < n; j++) { // Inner: O(n)", "            if (arr[j] < arr[min_idx])", "                min_idx = j;", "        }", "        if (min_idx != i) // Swap happens at most n times", "            swap(arr[i], arr[min_idx]);", "    }", "}"],
                space: ["// SPACE COMPLEXITY: O(1)", "void selectionSort(vector<int>& arr) {", "    int n = arr.size();", "    for (int i = 0; i < n - 1; i++) {", "        int min_idx = i; // Stack variable -> O(1)", "        for (int j = i + 1; j < n; j++) {", "            if (arr[j] < arr[min_idx])", "                min_idx = j;", "        }", "        if (min_idx != i)", "            swap(arr[i], arr[min_idx]); // In-place", "    }", "}"]
            },
            js: {
                standard: ["async function selectionSort(arr) {", "    let n = arr.length;", "    for (let i = 0; i < n; i++) {", "        let minIdx = i;", "        for (let j = i + 1; j < n; j++) {", "            if (arr[j] < arr[minIdx]) {", "                minIdx = j;", "            }", "        }", "        if (minIdx !== i) {", "            [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];", "        }", "    }", "}"],
                time: ["// TIME COMPLEXITY: O(n^2)", "async function selectionSort(arr) {", "    let n = arr.length;", "    for (let i = 0; i < n; i++) {   // Runs n times", "        let minIdx = i;", "        for (let j = i + 1; j < n; j++) { // Runs n-i times", "            if (arr[j] < arr[minIdx]) {", "                minIdx = j;", "            }", "        }", "        if (minIdx !== i) { // Swap O(1)", "            [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];", "        }", "    }", "}"],
                space: ["// SPACE COMPLEXITY: O(1)", "async function selectionSort(arr) {", "    let n = arr.length;", "    for (let i = 0; i < n; i++) {", "        let minIdx = i; // Primitive var -> O(1)", "        for (let j = i + 1; j < n; j++) {", "            if (arr[j] < arr[minIdx]) {", "                minIdx = j;", "            }", "        }", "        if (minIdx !== i) {", "            [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];", "        }", "    }", "}"]
            }
        };

        let currentData = [50, 30, 20, 10, 40];
        let sorting = false;
        let paused = false;
        let abort = false;
        let resolveStep = null;
        let delayTime = 500;
        let currentLang = 'python';
        let currentMode = 'standard';
        let stepCount = 0;
        
        window.onload = () => { renderCode(); initRandom(); };

        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.code-tabs .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderCode();
        }

        function setViewMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.view-mode-tabs .view-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
            renderCode();
        }

        function renderCode() {
            const container = document.getElementById('codeDisplay');
            container.innerHTML = '';
            codeSnippets[currentLang][currentMode].forEach((line, idx) => {
                const div = document.createElement('div');
                div.className = 'code-line'; div.id = `line-${idx}`; 
                if (currentMode !== 'standard' && (line.includes('//') || line.includes('#'))) {
                    const cls = currentMode === 'time' ? 'comment-time' : 'comment-space';
                    div.innerHTML = line.replace(/(\/\/|#)(.*)/, `<span class="${cls}">$1$2</span>`);
                } else if (currentMode === 'standard' && (line.includes('//') || line.includes('#'))) {
                     div.innerHTML = line.replace(/(\/\/|#)(.*)/, `<span class="comment-std">$1$2</span>`);
                } else div.innerText = line;
                container.appendChild(div);
            });
        }

        function highlightLine(lineIndex) {
            let adjustedIndex = lineIndex;
            document.querySelectorAll('.code-line').forEach(l => l.classList.remove('active-line'));
            const el = document.getElementById(`line-${adjustedIndex}`);
            if (el) el.classList.add('active-line');
        }

        function drawBars(highlights = {}) {
            const container = document.getElementById('barContainer');
            container.innerHTML = '';
            const maxVal = Math.max(...currentData, 80); 
            currentData.forEach((val, idx) => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.id = `bar-${idx}`;
                const h = (val / maxVal) * 100; 
                bar.style.height = `${Math.max(h, 10)}%`;
                
                if (highlights[idx]) bar.classList.add(highlights[idx]);

                const span = document.createElement('span');
                span.innerText = val;
                bar.appendChild(span);
                container.appendChild(bar);
            });
        }

        function addTraceStep(arrCopy, idx1, type, message) {
            stepCount++;
            const container = document.getElementById('traceLog');
            if (container.children.length > 0 && container.children[0].innerText.includes('Press Play')) {
                container.innerHTML = '';
            }

            const stepDiv = document.createElement('div');
            stepDiv.className = 'trace-step';

            const contentRow = document.createElement('div');
            contentRow.style.display = 'flex';
            contentRow.style.alignItems = 'center';
            contentRow.style.gap = '8px';

            const numSpan = document.createElement('span');
            numSpan.style.color = '#64748b'; 
            numSpan.style.fontWeight = '700'; 
            numSpan.style.minWidth = '25px'; 
            numSpan.innerText = `${stepCount}.`;

            const arrayRow = document.createElement('div');
            arrayRow.className = 'trace-array-row';
            arrayRow.style.flex = '1'; 
            
            arrayRow.appendChild(document.createTextNode('[ '));
            arrCopy.forEach((num, i) => {
                const span = document.createElement('span');
                span.className = 'num-span';
                span.innerText = num;
                
                // Visual logic for trace
                if (i === idx1) {
                    if (type === 'min') span.classList.add('hl-accent');
                    else if (type === 'compare') span.classList.add('hl-yellow');
                    else if (type === 'sorted') span.classList.add('hl-green');
                }
                
                arrayRow.appendChild(span);
                if (i < arrCopy.length - 1) arrayRow.appendChild(document.createTextNode(', '));
            });
            arrayRow.appendChild(document.createTextNode(' ]'));

            contentRow.appendChild(numSpan);
            contentRow.appendChild(arrayRow);

            const msgRow = document.createElement('div');
            msgRow.className = 'trace-message';
            msgRow.style.marginLeft = '33px';
            msgRow.innerHTML = `<span class="arrow-icon">‚Ü≥</span> ${message}`;

            stepDiv.appendChild(contentRow);
            stepDiv.appendChild(msgRow);
            
            container.appendChild(stepDiv);
            container.scrollTop = container.scrollHeight;
        }

        function clearLog() {
            document.getElementById('traceLog').innerHTML = '<div style="color:#9ca3af; text-align:center; margin-top:50px; font-size:0.9rem;">Log Cleared</div>';
            stepCount = 0;
        }

        function initRandom() {
            reset();
            currentData = Array.from({length: 8}, () => Math.floor(Math.random() * 90) + 10);
            drawBars();
            updateStatus("Ready (Random)");
        }
        
        function initBest() {
            reset();
            currentData = [10, 20, 30, 40, 50, 60, 70, 80];
            drawBars();
            updateStatus("Ready (Best Case)");
        }
        
        function initWorst() {
            reset();
            currentData = [80, 70, 60, 50, 40, 30, 20, 10];
            drawBars();
            updateStatus("Ready (Worst Case)");
        }

        function initCustom() {
            const input = document.getElementById('customInput').value;
            if(!input) return;
            const arr = input.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
            if(arr.length > 0) { reset(); currentData = arr; drawBars(); }
        }

        function reset() {
            abort = true; sorting = false; paused = false;
            stepCount = 0;
            if (resolveStep) resolveStep(); 
            updateStatus("Ready"); enableControls(true); highlightLine(-1);
            drawBars(); 
            document.getElementById('traceLog').innerHTML = '<div style="color:#9ca3af; text-align:center; margin-top:50px; font-size:0.9rem;">Press Play...</div>';
            document.querySelector('.stage-container').classList.remove('fullscreen');
        }

        async function startSort() {
            if (sorting && paused) {
                paused = false; if (resolveStep) resolveStep();
                document.getElementById('btnPause').classList.remove('active'); return;
            }
            if (sorting) return;
            sorting = true; abort = false; enableControls(false);
            stepCount = 0;
            document.getElementById('traceLog').innerHTML = ''; 
            await selectionSortAlgo();
            sorting = false; enableControls(true);
        }

        function pauseSort() {
            if (!sorting) return;
            paused = true; updateStatus("Paused");
            document.getElementById('btnPause').classList.add('active'); 
        }

        function stepSort() {
            if (!sorting) { startSort(); paused = true; return; }
            paused = false; if(resolveStep) resolveStep(); paused = true; 
        }

        function enableControls(enabled) {
            document.getElementById('btnPlay').disabled = !enabled;
            document.getElementById('btnPause').disabled = enabled;
            document.getElementById('customInput').disabled = !enabled;
        }

        function updateStatus(msg) { document.getElementById('statusText').innerText = msg; }

        async function wait() {
            if (abort) return Promise.reject("Aborted");
            const rawSpeed = document.getElementById('speedRange').value; 
            const delay = 1050 - rawSpeed; 
            if (paused) await new Promise(resolve => { resolveStep = resolve; });
            else await new Promise(resolve => setTimeout(resolve, delay));
        }

        async function selectionSortAlgo() {
            let n = currentData.length;
            
            try {
                for (let i = 0; i < n; i++) {
                    highlightLine(2); 
                    let min_idx = i;
                    
                    // Initial highlight for start of pass
                    let highlights = {};
                    for(let x=0; x<i; x++) highlights[x] = 'sorted';
                    highlights[i] = 'compare'; // Current target
                    drawBars(highlights);
                    updateStatus(`Searching for minimum starting at index ${i}`);
                    await wait();

                    highlightLine(3);
                    
                    for (let j = i + 1; j < n; j++) {
                        if (abort) return;

                        highlightLine(5); // For loop
                        
                        // Show scan
                        highlights = {};
                        for(let x=0; x<i; x++) highlights[x] = 'sorted';
                        highlights[min_idx] = 'min'; // Current smallest found
                        highlights[j] = 'compare'; // Currently scanning
                        drawBars(highlights);
                        
                        updateStatus(`Comparing ${currentData[j]} with current min ${currentData[min_idx]}`);
                        await wait();

                        highlightLine(6); // If check
                        if (currentData[j] < currentData[min_idx]) {
                            min_idx = j;
                            addTraceStep([...currentData], min_idx, 'min', `Found new minimum: ${currentData[min_idx]}`);
                            highlightLine(7);
                            
                            // Visual update for new min
                            highlights[min_idx] = 'min';
                            drawBars(highlights);
                            await wait();
                        }
                    }

                    // Swap logic
                    highlightLine(9);
                    if (min_idx != i) {
                        updateStatus(`Swapping ${currentData[i]} and ${currentData[min_idx]}`);
                        
                        // Show swap intent
                        highlights = {};
                        for(let x=0; x<i; x++) highlights[x] = 'sorted';
                        highlights[i] = 'swap';
                        highlights[min_idx] = 'swap';
                        drawBars(highlights);
                        await wait();

                        let temp = currentData[i];
                        currentData[i] = currentData[min_idx];
                        currentData[min_idx] = temp;
                        
                        addTraceStep([...currentData], i, 'sorted', `Swapped ${currentData[i]} to position ${i}`);
                        highlightLine(10);
                    } else {
                        addTraceStep([...currentData], i, 'sorted', `${currentData[i]} is already in correct position`);
                    }

                    // Mark i as sorted
                    highlights = {};
                    for(let x=0; x<=i; x++) highlights[x] = 'sorted';
                    drawBars(highlights);
                    await wait();
                }

                const container = document.getElementById('traceLog');
                const div = document.createElement('div');
                div.style.textAlign = 'center'; div.style.marginTop = '15px';
                div.style.color = '#10b981'; div.style.fontWeight = 'bold';
                div.innerText = 'Array Fully Sorted!';
                container.appendChild(div);
                container.scrollTop = container.scrollHeight;

                updateStatus("Sorting Complete! üéâ");
                highlightLine(-1);

            } catch (e) { console.log(e); }
        }
    </script>
</body>
</html>